var _ref,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d};Annotator.Plugin.RichText=(function(a){__extends(b,a);b.prototype.options={tinymce:{selector:"li.annotator-item textarea",plugins:"media image insertdatetime link code",menubar:false,toolbar_items_size:"small",extended_valid_elements:"iframe[src|frameborder|style|scrolling|class|width|height|name|align|id]",toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media rubric | code ",}};function b(d,c){_ref=b.__super__.constructor.apply(this,arguments);return _ref}b.prototype.pluginInit=function(){console.log("RichText-pluginInit");var d=this.annotator,c=this.annotator.editor;if(!Annotator.supported()){return}d.editor.addField({type:"input",load:this.updateEditor,});d.viewer.addField({load:this.updateViewer,});d.subscribe("annotationEditorShown",function(){$(d.editor.element).find(".mce-tinymce")[0].style.display="block";$(d.editor.element).find(".mce-container").css("z-index",3000000000);d.editor.checkOrientation()});d.subscribe("annotationEditorHidden",function(){$(d.editor.element).find(".mce-tinymce")[0].style.display="none"});this.options.tinymce.setup=function(e){e.on("change",function(f){$(c.element).find("textarea")[0].value=tinymce.activeEditor.getContent()});e.on("Init",function(f){$(".mce-container").css("z-index","3090000000000000000")});e.addButton("rubric",{icon:"rubric",title:"Insert a rubric",onclick:function(){e.windowManager.open({title:"Insert a public rubric of the webside https://gteavirtual.org/rubric   ",body:[{type:"textbox",name:"url",label:"Url"}],onsubmit:function(l){var h=l.data.url,g="irb",k;g=g.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var j=new RegExp("[\\?&]"+g+"=([^&#]*)"),i=j.exec(h);k=i==null?"":decodeURIComponent(i[1].replace(/\+/g," "));if(k==""){e.windowManager.alert("Error: The given webpage didn't have a irb variable in the url")}else{var f="<iframe src='https://gteavirtual.org/rubric/?mod=portal&scr=viewrb&evt=frame&irb="+k+"' style='width:800px;height:600px;overflow-y: scroll;background:transparent' frameborder='0' ></iframe>";e.setContent(e.getContent()+f);$(c.element).find("textarea")[0].value=e.getContent()}}});e.insertContent("Main button");e.label="My Button"}})};tinymce.init(this.options.tinymce)};b.prototype.updateEditor=function(d,c){var e=typeof c.text!="undefined"?c.text:"";tinymce.activeEditor.setContent(e);$(d).remove()};b.prototype.updateViewer=function(e,c){var d=$(e.parentNode).find("div:first-of-type")[0];d.innerHTML=c.text;$(d).addClass("richText-annotation");$(e).remove()};return b})(Annotator.Plugin);